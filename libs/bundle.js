!function(t){function i(o){if(e[o])return e[o].exports;var n=e[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){"use strict";e(1),e(2),e(3),e(4),e(5),e(6)},function(t,i){"use strict";i.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ngStorage"])},function(t,i,e){"use strict";var o=e(1).app;o.config(["$urlRouterProvider","$locationProvider",function(t,i){i.html5Mode(!0),t.when("","/").otherwise("/")}]),o.config(["$stateProvider",function(t){t.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("index.image",{url:"{id:int}",controller:"ImageController",templateUrl:"/public/views/image.html"}).state("history",{url:"/history",controller:"HistoryController",templateUrl:"/public/views/history.html"})}])},function(t,i,e){"use strict";var o=e(1).app;o.controller("MainController",["$scope","$mdSidenav","$state","$mdDialog","$localStorage","$interval","$location","$http",function(t,i,e,o,n,a,r,l){n.$default({autoChange:!1,autoShowHelpInfo:!0,imagesHistory:[]}),t.autoChange={status:n.autoChange,interval:null},t.setAutoChange=function(){n.autoChange=t.autoChange.status},t.openMenu=function(){i("left").toggle()},t.helpDialog={autoShow:n.autoShowHelpInfo},t.setHelpInfo=function(){n.autoShowHelpInfo=t.helpDialog.autoShow},t.showHelpDialog=function(){t.dialog=o.show({preserveScope:!0,scope:t,templateUrl:"/public/views/help.html",parent:angular.element(document.body),clickOutsideToClose:!0})},t.closeDialog=function(){o.hide(t.dialog)},t.menus=[{name:"首页",icon:"home",click:function(){r.path().match(/^\/\d{1,}$/)||e.go("index")}},{name:"浏览记录",icon:"history",click:function(){return e.go("history")}},{name:"帮助",icon:"help_outline",click:function(){return t.showHelpDialog()}},{name:"关于本项目",icon:"code",click:function(){window.location="https://github.com/gyteng/jandan-ooxx"}}],t.menuClick=function(e){t.menus[e].click(),i("left").close()},t.$on("$stateChangeStart",function(i,e,o,n,r,l){"index.image"===n.name&&"index.image"!==e.name&&t.autoChange.interval&&a.cancel(t.autoChange.interval)}),n.autoShowHelpInfo&&t.showHelpDialog(),t.public={addToHistory:!0,currentImage:{},images:[],history:n.imagesHistory},t.getImage=function(){return l.get("/api/image",{params:{number:60}}).then(function(i){return i.data.forEach(function(i){t.public.images.filter(function(t){return t.id===i.id})[0]||t.public.images.push(i)}),i})},t.getImageById=function(i){return l.get("/api/image/"+i).then(function(i){return t.public.images.push(i.data),i})},t.$watch("public.images",function(){t.public.images.length<15&&t.getImage()}),t.addHistory=function(i){t.public.history=t.public.history.filter(function(t){return t.id!==i.id}),t.public.history.push(i),t.public.history.length>60&&t.public.history.splice(0,t.public.history.length-60)},t.setCurrentImage=function(i){i?!function(){var e=t.public.addToHistory,o=t.public.images.filter(function(t){return t.id===i})[0];o?(t.public.currentImage=o,e?t.addHistory(t.public.currentImage):t.public.addToHistory=!0):t.getImageById(i).then(function(){t.setCurrentImage(i,e)})}():t.public.images.length?(t.public.currentImage=t.public.images[0],t.addHistory(t.public.currentImage)):t.getImage.then(function(){t.setCurrentImage()})},t.randomImage=function(){if(t.public.images.length>1){t.public.images.splice(0,1);var i=t.public.images[0];t.addHistory(i),e.go("index.image",{id:i.id})}else t.getImage().then(function(){t.randomImage()})},t.prevImage=function(){var i=null;if(t.public.history.forEach(function(e,o){e.id===t.public.currentImage.id&&(i=o)}),i>1){t.public.addToHistory=!1;var o=t.public.history[i-1].id;e.go("index.image",{id:o})}},t.nextImage=function(){var i=null;if(t.public.history.forEach(function(e,o){e.id===t.public.currentImage.id&&(i=o)}),i<t.public.history.length-1){t.public.addToHistory=!1;var o=t.public.history[i+1].id;e.go("index.image",{id:o})}else t.randomImage()}}])},function(t,i,e){"use strict";var o=e(1).app;o.controller("IndexController",["$scope","$http","$state","$stateParams","$timeout","$interval","$localStorage","$location",function(t,i,e,o,n,a,r,l){if("index"===e.current.name){if(t.public.images[0])return void e.go("index.image",{id:t.public.images[0].id});t.getImage().then(function(){e.go("index.image",{id:t.public.images[0].id})})}}])},function(t,i,e){"use strict";var o=e(1).app;o.controller("ImageController",["$scope","$http","$state","$stateParams","$timeout","$interval","$localStorage",function(t,i,e,o,n,a,r){var l=o.id;t.setCurrentImage(l)}])},function(t,i,e){"use strict";var o=e(1).app;o.controller("HistoryController",["$scope","$localStorage","$state","$mdMedia",function(t,i,e,o){return t.public.history.length?(t.divHeightStyle={height:100/3+"vw"},o("md")&&(t.divHeightStyle.height="25vw"),o("gt-md")&&(t.divHeightStyle.height=100/6+"vw"),t.history=i.imagesHistory.map(function(t){return{id:t.id,url:t.url,width:1,height:1,style:{width:"100%",overflow:"hidden"}}}),t.history.forEach(function(i,e){var o=new Image;o.onload=function(){t.history[e].width=o.width,t.history[e].height=o.height,o.height<o.width&&(t.history[e].style={height:"100%","max-width":"none","min-width":100/i.height*i.width+"%"})},o.src=i.url}),void(t.toImage=function(i){var o=t.public.history[i].id;t.public.addToHistory=!1,e.go("index.image",{id:o})})):e.go("index")}])}]);