!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";i(1),i(2),i(3),i(4),i(5),i(6)},function(e,t){"use strict";t.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ngStorage"])},function(e,t,i){"use strict";var n=i(1).app;n.config(["$urlRouterProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("","/").otherwise("/")}]),n.config(["$stateProvider",function(e){e.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("index.image",{url:"{id:int}",controller:"ImageController",templateUrl:"/public/views/image.html"}).state("history",{url:"/history",controller:"HistoryController",templateUrl:"/public/views/history.html"})}]),n.directive("longPress",["$timeout",function(e){return{restrict:"A",link:function(t,i,n){i.bind("mousedown",function(i){t.longPress=!0,t.click=!0,e(function(){t.click=!1,t.longPress&&n.onLongPress&&t.$apply(function(){t.$eval(n.onLongPress,{$event:i})})},n.timeOut||600),n.onTouch&&t.$apply(function(){t.$eval(n.onTouch,{$event:i})})}),i.bind("mouseup",function(e){t.longPress=!1,n.onTouchEnd&&t.$apply(function(){t.$eval(n.onTouchEnd,{$event:e})}),t.click&&n.onClick&&t.$apply(function(){t.$eval(n.onClick,{$event:e})})})}}}])},function(e,t,i){"use strict";var n=i(1).app;n.controller("MainController",["$scope","$mdSidenav","$state","$mdDialog","$localStorage","$interval","$location","$http",function(e,t,i,n,o,a,r,l){o.$default({autoChange:!1,autoShowHelpInfo:!0,imagesHistory:[]}),e.autoChange={status:o.autoChange,interval:null},e.setAutoChange=function(){o.autoChange=e.autoChange.status},e.openMenu=function(){t("left").toggle()},e.helpDialog={autoShow:o.autoShowHelpInfo},e.setHelpInfo=function(){o.autoShowHelpInfo=e.helpDialog.autoShow},e.showHelpDialog=function(){e.dialog=n.show({preserveScope:!0,scope:e,templateUrl:"/public/views/help.html",parent:angular.element(document.body),clickOutsideToClose:!0})},e.closeDialog=function(){n.hide(e.dialog)},e.menus=[{name:"首页",icon:"home",click:function(){r.path().match(/^\/\d{1,}$/)||i.go("index")}},{name:"浏览记录",icon:"history",click:function(){return i.go("history")}},{name:"帮助",icon:"help_outline",click:function(){return e.showHelpDialog()}},{name:"关于本项目",icon:"code",click:function(){window.location="https://github.com/gyteng/jandan-ooxx"}}],e.menuClick=function(i){e.menus[i].click(),t("left").close()},e.$on("$stateChangeStart",function(t,i,n,o,r,l){"index.image"===o.name&&"index.image"!==i.name&&e.autoChange.interval&&a.cancel(e.autoChange.interval)}),o.autoShowHelpInfo&&e.showHelpDialog(),e.imageUrlPreload=60,e.imagePreload=15,e.public={addToHistory:!0,currentImage:{},images:[],history:o.imagesHistory},e.getImage=function(){return l.get("/api/image",{params:{number:e.imageUrlPreload-e.public.images.length}}).then(function(t){return t.data.forEach(function(t){e.public.images.filter(function(e){return e.id===t.id})[0]||e.public.images.push(t)}),t})},e.getImageById=function(t){return l.get("/api/image/"+t).then(function(t){return e.public.images.push(t.data),t})},e.$watch("public.images.length",function(){e.public.images.length<e.imageUrlPreload/2&&e.getImage()}),e.addHistory=function(t){e.public.history=e.public.history.filter(function(e){return e.id!==t.id}),e.public.history.push(t),e.public.history.length>60&&e.public.history.splice(0,e.public.history.length-60)},e.setCurrentImage=function(t){t?!function(){var i=e.public.addToHistory,n=e.public.images.filter(function(e){return e.id===t})[0];n?(e.public.currentImage=n,i?e.addHistory(e.public.currentImage):e.public.addToHistory=!0):e.getImageById(t).then(function(){e.setCurrentImage(t,i)})}():e.public.images.length?(e.public.currentImage=e.public.images[0],e.addHistory(e.public.currentImage)):e.getImage.then(function(){e.setCurrentImage()})},e.randomImage=function(){if(e.public.images.length>1){e.public.images.splice(0,1);var t=e.public.images[0];e.addHistory(t),i.go("index.image",{id:t.id})}else e.getImage().then(function(){e.randomImage()})},e.prevImage=function(){var t=null;if(e.public.history.forEach(function(i,n){i.id===e.public.currentImage.id&&(t=n)}),t>1){e.public.addToHistory=!1;var n=e.public.history[t-1].id;i.go("index.image",{id:n})}},e.nextImage=function(){var t=null;if(e.public.history.forEach(function(i,n){i.id===e.public.currentImage.id&&(t=n)}),t<e.public.history.length-1){e.public.addToHistory=!1;var n=e.public.history[t+1].id;i.go("index.image",{id:n})}else e.randomImage()}}])},function(e,t,i){"use strict";var n=i(1).app;n.controller("IndexController",["$scope","$http","$state","$stateParams","$timeout","$interval","$localStorage","$location",function(e,t,i,n,o,a,r,l){if("index"===i.current.name){if(e.public.images[0])return void i.go("index.image",{id:e.public.images[0].id});e.getImage().then(function(){i.go("index.image",{id:e.public.images[0].id})})}}])},function(e,t,i){"use strict";var n=i(1).app;n.controller("ImageController",["$scope","$http","$state","$stateParams","$timeout","$interval","$localStorage",function(e,t,i,n,o,a,r){var l=n.id;e.setCurrentImage(l)}])},function(e,t,i){"use strict";var n=i(1).app;n.controller("HistoryController",["$scope","$localStorage","$state","$mdMedia",function(e,t,i,n){return e.public.history.length?(e.divHeightStyle={height:100/3+"vw"},n("md")&&(e.divHeightStyle.height="25vw"),n("gt-md")&&(e.divHeightStyle.height=100/6+"vw"),e.history=t.imagesHistory.map(function(e){return{id:e.id,url:e.url,width:1,height:1,style:{width:"100%",overflow:"hidden"}}}),e.history.forEach(function(t,i){var n=new Image;n.onload=function(){e.history[i].width=n.width,e.history[i].height=n.height,n.height<n.width&&(e.history[i].style={height:"100%","max-width":"none","min-width":100/t.height*t.width+"%"})},n.src=t.url}),void(e.toImage=function(t){var n=e.public.history[t].id;e.public.addToHistory=!1,i.go("index.image",{id:n})})):i.go("index")}])}]);