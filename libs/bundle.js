!function(i){function e(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return i[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var t={};return e.m=i,e.c=t,e.p="",e(0)}([function(i,e,t){"use strict";t(1),t(2),t(3),t(4),t(5),t(6),t(7)},function(i,e){"use strict";e.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ngStorage"])},function(i,e,t){"use strict";var n=t(1).app;n.config(["$urlRouterProvider","$locationProvider",function(i,e){e.html5Mode(!0),i.when("","/").otherwise("/")}]),n.config(["$stateProvider",function(i){i.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("index.image",{url:"{id:int}",controller:"ImageController",templateUrl:"/public/views/image.html"}).state("history",{url:"/history",controller:"HistoryController",templateUrl:"/public/views/history.html"}).state("password",{url:"/password",controller:"PasswordController",templateUrl:"/public/views/password.html"})}]),n.directive("longPress",["$timeout",function(i){return{restrict:"A",link:function(e,t,n){t.bind("mousedown",function(t){e.longPress=!0,e.click=!0,i(function(){e.click=!1,e.longPress&&n.onLongPress&&e.$apply(function(){e.$eval(n.onLongPress,{$event:t})})},n.timeOut||600),n.onTouch&&e.$apply(function(){e.$eval(n.onTouch,{$event:t})})}),t.bind("mouseup",function(i){e.longPress=!1,n.onTouchEnd&&e.$apply(function(){e.$eval(n.onTouchEnd,{$event:i})}),e.click&&n.onClick&&e.$apply(function(){e.$eval(n.onClick,{$event:i})})})}}}])},function(i,e,t){"use strict";var n=t(1).app;n.controller("MainController",["$scope","$mdSidenav","$state","$mdDialog","$localStorage","$interval","$location","$http",function(i,e,t,n,o,r,c,a){o.$default({settings:{autoChange:!1,autoShowHelpInfo:!0},imagesHistory:[]}),i.public={isAdmin:!1,isFavorite:!1,addToHistory:!0,currentImage:{},images:[],view:[],history:o.imagesHistory,settings:o.settings},i.checkAdmin=function(){a.get("/api/login").then(function(e){i.public.isAdmin=e.data.isLogin})},i.checkAdmin(),i.showHelpDialog=function(){i.dialog=n.show({preserveScope:!0,scope:i,templateUrl:"/public/views/help.html",parent:angular.element(document.body),clickOutsideToClose:!0})},i.closeHelpDialog=function(){n.hide(i.dialog)},i.public.settings.autoShowHelpInfo&&i.showHelpDialog(),i.favorite=function(){i.public.isFavorite=!0,a.post("/api/image/favorite",{id:i.public.currentImage.id}).then().catch()},i.menus=[{name:"首页",icon:"home",click:function(){c.path().match(/^\/\d{1,}$/)||t.go("index")}},{name:"浏览记录",icon:"history",click:function(){return t.go("history")}},{name:"帮助",icon:"help_outline",click:function(){return i.showHelpDialog()}},{name:"管理",icon:"settings",click:function(){return t.go("password")}},{name:"关于本项目",icon:"code",click:function(){window.location="https://github.com/gyteng/jandan-ooxx"}}],i.$watch("public.isAdmin",function(){return console.log(i.public.isAdmin),i.public.isAdmin?(i.menus[3].name="退出",i.menus[3].icon="exit_to_app",void(i.menus[3].click=function(){a.post("/api/logout").then(function(){i.public.isAdmin=!1})})):(i.menus[3].name="管理",i.menus[3].icon="settings",void(i.menus[3].click=function(){t.go("password")}))}),i.openMenu=function(){e("left").toggle()},i.menuClick=function(t){i.menus[t].click(),e("left").close()},i.imageUrlPreload=60,i.imagePreload=15,i.getImage=function(){return a.get("/api/image",{params:{number:i.imageUrlPreload-i.public.images.length}}).then(function(e){return e.data.forEach(function(e){i.public.images.filter(function(i){return i.id===e.id})[0]||i.public.images.push(e)}),e})},i.getImageById=function(e){return a.get("/api/image/"+e).then(function(e){return i.public.images.push(e.data),e})},i.$watch("public.images.length",function(){i.public.images.length<i.imageUrlPreload/2&&i.getImage()}),i.addHistory=function(e){i.public.history=i.public.history.filter(function(i){return i.id!==e.id}),i.public.history.push(e),i.public.history.length>60&&i.public.history.splice(0,i.public.history.length-60)},i.setCurrentImage=function(e){e?!function(){var t=i.public.addToHistory,n=i.public.images.filter(function(i){return i.id===e})[0];n?(i.public.currentImage=n,t?i.addHistory(i.public.currentImage):i.public.addToHistory=!0):i.getImageById(e).then(function(){i.setCurrentImage(e,t)})}():i.public.images.length?(i.public.currentImage=i.public.images[0],i.addHistory(i.public.currentImage)):i.getImage.then(function(){i.setCurrentImage()})},i.randomImage=function(){if(i.public.images.length>1){i.public.images.splice(0,1);var e=i.public.images[0];i.addHistory(e),t.go("index.image",{id:e.id})}else i.getImage().then(function(){i.randomImage()})},i.prevImage=function(){var e=null;if(i.public.history.forEach(function(t,n){t.id===i.public.currentImage.id&&(e=n)}),e>1){i.public.addToHistory=!1;var n=i.public.history[e-1].id;t.go("index.image",{id:n})}},i.nextImage=function(){var e=null;if(i.public.history.forEach(function(t,n){t.id===i.public.currentImage.id&&(e=n)}),e<i.public.history.length-1){i.public.addToHistory=!1;var n=i.public.history[e+1].id;t.go("index.image",{id:n})}else i.randomImage()},r(function(){i.public.view.length&&(a.post("/api/image/view",{id:i.public.view}),i.public.view=[])},1e4)}])},function(i,e,t){"use strict";var n=t(1).app;n.controller("IndexController",["$scope","$state",function(i,e){if("index"===e.current.name){if(i.public.images[0])return void e.go("index.image",{id:i.public.images[0].id});i.getImage().then(function(){e.go("index.image",{id:i.public.images[0].id})})}}])},function(i,e,t){"use strict";var n=t(1).app;n.controller("ImageController",["$scope","$stateParams","$http","$interval",function(i,e,t,n){var o=e.id;i.setCurrentImage(o),i.public.isFavorite=!1,i.public.view.push(o),i.isManagerMenuOpen=!1}])},function(i,e,t){"use strict";var n=t(1).app;n.controller("HistoryController",["$scope","$localStorage","$state","$mdMedia",function(i,e,t,n){return i.public.history.length?(i.divHeightStyle={height:100/3+"vw"},n("md")&&(i.divHeightStyle.height="25vw"),n("gt-md")&&(i.divHeightStyle.height=100/6+"vw"),i.history=e.imagesHistory.map(function(i){return{id:i.id,url:i.url,width:1,height:1,style:{width:"100%",overflow:"hidden"}}}),i.history.forEach(function(e,t){var n=new Image;n.onload=function(){i.history[t].width=n.width,i.history[t].height=n.height,n.height<n.width&&(i.history[t].style={height:"100%","max-width":"none","min-width":100/e.height*e.width+"%"})},n.src=e.url}),void(i.toImage=function(e){var n=i.public.history[e].id;i.public.addToHistory=!1,t.go("index.image",{id:n})})):t.go("index")}])},function(i,e,t){"use strict";var n=t(1).app;n.controller("PasswordController",["$scope","$state","$stateParams","$http",function(i,e,t,n){i.manager={password:"",keypress:function(e){13===e.keyCode&&i.checkPassword()}},i.checkPassword=function(){i.manager.password&&n.post("/api/login",{password:i.manager.password}).then(function(){i.public.isAdmin=!0,e.go("index")}).catch(function(){i.public.isAdmin=!1,e.go("index")})}}])}]);