!function(i){function t(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return i[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var e={};return t.m=i,t.c=e,t.p="",t(0)}([function(i,t,e){"use strict";e(1),e(2),e(3),e(4),e(5),e(6),e(7)},function(i,t){"use strict";t.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ngStorage"])},function(i,t,e){"use strict";var n=e(1).app;n.config(["$urlRouterProvider","$locationProvider",function(i,t){t.html5Mode(!0),i.when("","/").otherwise("/")}]),n.config(["$stateProvider",function(i){i.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("index.image",{url:"{id:int}",controller:"ImageController",templateUrl:"/public/views/image.html"}).state("history",{url:"/history",controller:"HistoryController",templateUrl:"/public/views/history.html"}).state("password",{url:"/password",controller:"PasswordController",templateUrl:"/public/views/password.html"})}]),n.directive("longPress",["$timeout",function(i){return{restrict:"A",link:function(t,e,n){e.bind("mousedown",function(e){t.longPress=!0,t.click=!0,i(function(){t.click=!1,t.longPress&&n.onLongPress&&t.$apply(function(){t.$eval(n.onLongPress,{$event:e})})},n.timeOut||600),n.onTouch&&t.$apply(function(){t.$eval(n.onTouch,{$event:e})})}),e.bind("mouseup",function(i){t.longPress=!1,n.onTouchEnd&&t.$apply(function(){t.$eval(n.onTouchEnd,{$event:i})}),t.click&&n.onClick&&t.$apply(function(){t.$eval(n.onClick,{$event:i})})})}}}])},function(i,t,e){"use strict";var n=e(1).app;n.controller("MainController",["$scope","$mdSidenav","$state","$mdDialog","$localStorage","$interval","$location","$http",function(i,t,e,n,o,r,c,l){o.$default({settings:{autoChange:!1,autoShowHelpInfo:!0},imagesHistory:[]}),i.public={isAdmin:!1,addToHistory:!0,currentImage:{},images:[],history:o.imagesHistory,settings:o.settings},i.checkAdmin=function(){l.get("/api/login").then(function(t){i.public.isAdmin=t.data.isLogin})},i.checkAdmin(),i.showHelpDialog=function(){i.dialog=n.show({preserveScope:!0,scope:i,templateUrl:"/public/views/help.html",parent:angular.element(document.body),clickOutsideToClose:!0})},i.closeHelpDialog=function(){n.hide(i.dialog)},i.public.settings.autoShowHelpInfo&&i.showHelpDialog(),i.menus=[{name:"首页",icon:"home",click:function(){c.path().match(/^\/\d{1,}$/)||e.go("index")}},{name:"浏览记录",icon:"history",click:function(){return e.go("history")}},{name:"帮助",icon:"help_outline",click:function(){return i.showHelpDialog()}},{name:"管理",icon:"settings",click:function(){return e.go("password")}},{name:"关于本项目",icon:"code",click:function(){window.location="https://github.com/gyteng/jandan-ooxx"}}],i.$watch("public.isAdmin",function(){return console.log(i.public.isAdmin),i.public.isAdmin?(i.menus[3].name="退出",i.menus[3].icon="exit_to_app",void(i.menus[3].click=function(){l.post("/api/logout").then(function(){i.public.isAdmin=!1})})):(i.menus[3].name="管理",i.menus[3].icon="settings",void(i.menus[3].click=function(){e.go("password")}))}),i.openMenu=function(){t("left").toggle()},i.menuClick=function(e){i.menus[e].click(),t("left").close()},i.imageUrlPreload=60,i.imagePreload=15,i.getImage=function(){return l.get("/api/image",{params:{number:i.imageUrlPreload-i.public.images.length}}).then(function(t){return t.data.forEach(function(t){i.public.images.filter(function(i){return i.id===t.id})[0]||i.public.images.push(t)}),t})},i.getImageById=function(t){return l.get("/api/image/"+t).then(function(t){return i.public.images.push(t.data),t})},i.$watch("public.images.length",function(){i.public.images.length<i.imageUrlPreload/2&&i.getImage()}),i.addHistory=function(t){i.public.history=i.public.history.filter(function(i){return i.id!==t.id}),i.public.history.push(t),i.public.history.length>60&&i.public.history.splice(0,i.public.history.length-60)},i.setCurrentImage=function(t){t?!function(){var e=i.public.addToHistory,n=i.public.images.filter(function(i){return i.id===t})[0];n?(i.public.currentImage=n,e?i.addHistory(i.public.currentImage):i.public.addToHistory=!0):i.getImageById(t).then(function(){i.setCurrentImage(t,e)})}():i.public.images.length?(i.public.currentImage=i.public.images[0],i.addHistory(i.public.currentImage)):i.getImage.then(function(){i.setCurrentImage()})},i.randomImage=function(){if(i.public.images.length>1){i.public.images.splice(0,1);var t=i.public.images[0];i.addHistory(t),e.go("index.image",{id:t.id})}else i.getImage().then(function(){i.randomImage()})},i.prevImage=function(){var t=null;if(i.public.history.forEach(function(e,n){e.id===i.public.currentImage.id&&(t=n)}),t>1){i.public.addToHistory=!1;var n=i.public.history[t-1].id;e.go("index.image",{id:n})}},i.nextImage=function(){var t=null;if(i.public.history.forEach(function(e,n){e.id===i.public.currentImage.id&&(t=n)}),t<i.public.history.length-1){i.public.addToHistory=!1;var n=i.public.history[t+1].id;e.go("index.image",{id:n})}else i.randomImage()}}])},function(i,t,e){"use strict";var n=e(1).app;n.controller("IndexController",["$scope","$state",function(i,t){if("index"===t.current.name){if(i.public.images[0])return void t.go("index.image",{id:i.public.images[0].id});i.getImage().then(function(){t.go("index.image",{id:i.public.images[0].id})})}}])},function(i,t,e){"use strict";var n=e(1).app;n.controller("ImageController",["$scope","$stateParams","$http",function(i,t,e){var n=t.id;i.setCurrentImage(n),e.put("/api/image/"+n).then().catch()}])},function(i,t,e){"use strict";var n=e(1).app;n.controller("HistoryController",["$scope","$localStorage","$state","$mdMedia",function(i,t,e,n){return i.public.history.length?(i.divHeightStyle={height:100/3+"vw"},n("md")&&(i.divHeightStyle.height="25vw"),n("gt-md")&&(i.divHeightStyle.height=100/6+"vw"),i.history=t.imagesHistory.map(function(i){return{id:i.id,url:i.url,width:1,height:1,style:{width:"100%",overflow:"hidden"}}}),i.history.forEach(function(t,e){var n=new Image;n.onload=function(){i.history[e].width=n.width,i.history[e].height=n.height,n.height<n.width&&(i.history[e].style={height:"100%","max-width":"none","min-width":100/t.height*t.width+"%"})},n.src=t.url}),void(i.toImage=function(t){var n=i.public.history[t].id;i.public.addToHistory=!1,e.go("index.image",{id:n})})):e.go("index")}])},function(i,t,e){"use strict";var n=e(1).app;n.controller("PasswordController",["$scope","$state","$stateParams","$http",function(i,t,e,n){i.manager={password:"",keypress:function(){}},i.checkPassword=function(){n.post("/api/login",{password:i.manager.password}).then(function(){i.public.isAdmin=!0,t.go("index")}).catch(function(){i.public.isAdmin=!1,t.go("index")})}}])}]);